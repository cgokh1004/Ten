<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="car">

	<insert id="create" parameterType="CarDTO">
	insert into car(carno, place, brand, filename, dprice, oil, howmany, passwd) 
	values(#{carno}, #{place}, #{brand}, #{filename}, #{dprice}, #{oil}, #{howmany}, #{passwd})
	</insert>
	
	<update id="update" parameterType="CarDTO">
	UPDATE car
	SET  place=#{place}, 
	  	 brand=#{brand}, 
	 	 filename=#{filename}, 
	 	 dprice=#{dprice}, 
		 oil=#{oil}, 
		 howmany=#{howmany}, 
		 passwd=#{passwd},
		 state=#{state}
	WHERE carno = #{carno} 
	</update>
	
	<select id="read" resultType="CarDTO" parameterType="String">
	select carno, place, brand, filename, dprice, oil, howmany, state, passwd
	from car
	where carno = #{carno}
	</select>
	
	<select id="list" resultType="CarDTO" parameterType="Map">
	select carno, place, brand, filename, dprice, oil, howmany, state, r
	from(
		select carno, place, brand, filename, dprice, oil, howmany, state, rownum r
		from(
			select carno, place, brand, filename, dprice, oil, howmany, state
			from car
			<where>
				<choose>
					<when test="col=='place'">
						place like '%' || #{word} || '%'
					</when>
					<when test="col=='brand'">
						brand like '%' || #{word} || '%'
					</when>
					<when test="col=='carno'">
						carno like '%' || #{word} || '%'
					</when>
				</choose>
			</where>
			order by carno desc
		)
	)
	<![CDATA[
	where r>=#{sno} and r<=#{eno}
	]]>
	</select>
	
	<delete id="delete" parameterType="String">
	delete from car
	where carno=#{carno}
	</delete>
	
	<select id="total" resultType="int" parameterType="map">
		SELECT count(*) FROM car
		<where>
			<choose>
				<when test="col=='carno'">
					carno LIKE '%' || #{word} || '%'
				</when>
				<when test="col=='place'">
					place LIKE '%' || #{word} || '%'
				</when>
				<when test="col=='brand'">
					content LIKE '%' || #{word} || '%'
				</when>
			</choose>
		</where>
	</select>
	
	<update id="updateFile" parameterType="Map">
		update car
		set filename =#{filename}
		where carno = #{carno}
	</update>
	
	<select id="checkPasswd" parameterType="map" resultType="int">
		SELECT COUNT(carno) as cnt
	    FROM car
	    WHERE carno=#{carno} AND passwd=#{passwd}
	</select>
	
</mapper>